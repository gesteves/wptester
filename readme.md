# wptester

A simple way to run WebPageTest tests and log them in Librato.

![](http://i.imgur.com/v4JNswc.png)

## Requirements

* A [Heroku](https://www.heroku.com/) account
* A [Librato](https://www.librato.com/) account, and a record-only [API token](https://metrics.librato.com/account/tokens)
* A [WebPageTest](https://www.webpagetest.org/getkey.php) API key

## Installation

Click this button to deploy directly to Heroku:

[![Deploy](https://www.herokucdn.com/deploy/button.png)](https://heroku.com/deploy)

## Usage

Once your app is deployed and running, go to the Resources page in the Heroku dashboard and open the Heroku Scheduler. Add a new job, make it daily (or hourly of you want, but keep in mind WPT only allows a limited number of tests each day, so it's kind of overkill), and make it run this rake task:

```
rake wpt:request SITE_URL:http://... PINGBACK_URL=https://...
```

The `SITE_URL` is the URL of the page you want to test in WPT.

The `PINGBACK_URL` is the URL on your new Heroku app WPT will ping once the test is finished. It follows the format:

```
https://HEROKU-APP-NAME.herokuapp.com/log/TOKEN/SOURCE
```

`HEROKU-APP-NAME` is, well, the name of the Heroku app you just created. `TOKEN` is the value of the autogenerated `TOKEN` environment variable, to make the URL hard to guess; you can get it in the config variables section of the Settings page in the Heroku dashboard. `SOURCE` is what you'll use in Librato to filter your metrics (e.g. if the page you're testing is your home page, you can put `homepage` as the source).

Save the scheduled job, let it run, and then you can set up your charts however you like in Librato.
